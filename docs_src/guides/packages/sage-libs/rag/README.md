# RAGç»„ä»¶æ–‡æ¡£å¯¼èˆª (RAG Components Documentation Guide)

æ¬¢è¿ä½¿ç”¨SAGEæ¡†æ¶çš„RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ç»„ä»¶æ–‡æ¡£ã€‚æœ¬å¯¼èˆªå°†å¸®åŠ©æ‚¨å¿«é€Ÿæ‰¾åˆ°æ‰€éœ€çš„æŠ€æœ¯æ–‡æ¡£å’Œå®ç°ç¤ºä¾‹ã€‚

## ğŸ“– æ–‡æ¡£ç»“æ„

### ç»„ä»¶æ–‡æ¡£ (`components/`)

åŒ…å«SAGEæ¡†æ¶ä¸­æ‰€æœ‰RAGæ ¸å¿ƒç»„ä»¶çš„è¯¦ç»†æŠ€æœ¯æ–‡æ¡£ï¼š

| æ–‡æ¡£                                         | ç»„ä»¶åŠŸèƒ½         | é€‚ç”¨åœºæ™¯   | éš¾åº¦çº§åˆ«      |
| -------------------------------------------- | ---------------- | ---------- | ------------- |
| [æ–‡æ¡£åŠ è½½å™¨](components/document_loaders.md) | æ–‡æ¡£è¯»å–ä¸é¢„å¤„ç† | æ•°æ®æ¥å…¥   | â­ å…¥é—¨       |
| [æ–‡æœ¬åˆ†å—å™¨](components/chunk.md)            | é•¿æ–‡æ¡£æ™ºèƒ½åˆ†å‰²   | æ•°æ®é¢„å¤„ç† | â­â­ åŸºç¡€     |
| [ç´¢å¼•æ„å»º](components/index_build.md)        | å‘é‡ç´¢å¼•æ„å»º     | ç¦»çº¿å»ºåº“   | â­â­â­ ä¸­çº§   |
| [æ£€ç´¢å™¨](components/retriever.md)            | å‘é‡ç›¸ä¼¼åº¦æ£€ç´¢   | åœ¨çº¿æŸ¥è¯¢   | â­â­ åŸºç¡€     |
| [é‡æ’åºå™¨](components/reranker.md)           | æ£€ç´¢ç»“æœç²¾æ’     | è´¨é‡ä¼˜åŒ–   | â­â­â­ ä¸­çº§   |
| [æç¤ºè¯ç”Ÿæˆå™¨](components/promptor.md)       | ä¸Šä¸‹æ–‡ç»„è£…       | æç¤ºå·¥ç¨‹   | â­â­ åŸºç¡€     |
| [ç”Ÿæˆå™¨](components/generator.md)            | ç­”æ¡ˆç”Ÿæˆ         | LLMè°ƒç”¨    | â­â­ åŸºç¡€     |
| [å¤–éƒ¨æœç´¢å™¨](components/search.md)           | å®æ—¶ä¿¡æ¯è·å–     | ä¿¡æ¯æ‰©å±•   | â­â­â­ ä¸­çº§   |
| [è¯„ä¼°å™¨](components/evaluate.md)             | ç³»ç»Ÿæ€§èƒ½è¯„ä¼°     | è´¨é‡ç›‘æ§   | â­â­â­â­ é«˜çº§ |

### å®ç°ç¤ºä¾‹ (`examples/`)

æä¾›å®Œæ•´çš„ç«¯åˆ°ç«¯å®ç°ç¤ºä¾‹ï¼š

| ç¤ºä¾‹                               | è¯´æ˜                          | å¤æ‚åº¦      |
| ---------------------------------- | ----------------------------- | ----------- |
| [RAGç³»ç»Ÿå®Œæ•´å®ç°](examples/RAG.md) | åŸºäºChromaDBçš„å®Œæ•´RAGé—®ç­”ç³»ç»Ÿ | â­â­â­ ä¸­çº§ |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–°æ‰‹å­¦ä¹ è·¯å¾„

å¦‚æœæ‚¨æ˜¯RAGæŠ€æœ¯çš„æ–°æ‰‹ï¼Œå»ºè®®æŒ‰ä»¥ä¸‹é¡ºåºå­¦ä¹ ï¼š

1. **ç†è§£åŸºç¡€æ¦‚å¿µ** ğŸ“š

   - é˜…è¯» [RAGç³»ç»Ÿå®Œæ•´å®ç°](examples/RAG.md) äº†è§£æ•´ä½“æ¶æ„
   - ç†è§£RAGçš„ä¸¤é˜¶æ®µå·¥ä½œæµç¨‹

1. **æŒæ¡æ ¸å¿ƒç»„ä»¶** ğŸ”§

   - [æ–‡æ¡£åŠ è½½å™¨](components/document_loaders.md) - å­¦ä¹ æ•°æ®è¾“å…¥
   - [æ–‡æœ¬åˆ†å—å™¨](components/chunk.md) - ç†è§£æ–‡æ¡£é¢„å¤„ç†
   - [ç´¢å¼•æ„å»º](components/index_build.md) - æŒæ¡å‘é‡åŒ–æµç¨‹

1. **å®ç°æ£€ç´¢ç”Ÿæˆ** ğŸ¯

   - [æ£€ç´¢å™¨](components/retriever.md) - å®ç°ç›¸ä¼¼åº¦æ£€ç´¢
   - [æç¤ºè¯ç”Ÿæˆå™¨](components/promptor.md) - å­¦ä¹ ä¸Šä¸‹æ–‡ç»„è£…
   - [ç”Ÿæˆå™¨](components/generator.md) - æ¥å…¥å¤§è¯­è¨€æ¨¡å‹

1. **ç³»ç»Ÿä¼˜åŒ–æå‡** âš¡

   - [é‡æ’åºå™¨](components/reranker.md) - æå‡æ£€ç´¢ç²¾åº¦
   - [å¤–éƒ¨æœç´¢å™¨](components/search.md) - æ‰©å±•ä¿¡æ¯æ¥æº
   - [è¯„ä¼°å™¨](components/evaluate.md) - ç›‘æ§ç³»ç»Ÿæ€§èƒ½

### å¼€å‘è€…å¿«é€Ÿå‚è€ƒ

#### åŸºç¡€RAGæµæ°´çº¿

```python
# æœ€å°åŒ–RAGå®ç°
from sage.libs.rag import ChromaRetriever, QAPromptor, OpenAIGenerator

# 1. æ£€ç´¢ç›¸å…³æ–‡æ¡£
retriever = ChromaRetriever(config)
docs = retriever.execute("ç”¨æˆ·æŸ¥è¯¢")

# 2. ç»„è£…æç¤ºè¯
promptor = QAPromptor()
prompt = promptor.execute(("ç”¨æˆ·æŸ¥è¯¢", docs))

# 3. ç”Ÿæˆç­”æ¡ˆ
generator = OpenAIGenerator(config)
answer = generator.execute(prompt)
```

#### å®Œæ•´ç³»ç»Ÿéƒ¨ç½²

```python
# ç”Ÿäº§çº§RAGç³»ç»Ÿ
from sage.libs.environment import LocalEnvironment


def deploy_rag_system(config):
    env = LocalEnvironment()
    (
        env.from_batch(JSONLBatch, config["source"])
        .map(ChromaRetriever, config["retriever"])
        .map(BGEReranker, config["reranker"])  # å¯é€‰ï¼šé‡æ’åº
        .map(QAPromptor, config["promptor"])
        .map(OpenAIGenerator, config["generator"])
        .sink(TerminalSink, config["sink"])
    )
    env.submit()
```

## ğŸ“‹ ç»„ä»¶é€‰æ‹©æŒ‡å—

### æ ¹æ®åº”ç”¨åœºæ™¯é€‰æ‹©ç»„ä»¶

#### ğŸ¢ ä¼ä¸šçŸ¥è¯†ç®¡ç†

- **æ ¸å¿ƒç»„ä»¶**ï¼šTextLoader + CharacterSplitter + ChromaRetriever + QAPromptor + OpenAIGenerator
- **æ¨èå¢å¼º**ï¼šBGERerankerï¼ˆæå‡å‡†ç¡®æ€§ï¼‰
- **ç‰¹ç‚¹**ï¼šé«˜ç²¾åº¦ã€å¯è¿½æº¯ã€å®‰å…¨å¯æ§

#### ğŸ”¬ å­¦æœ¯ç ”ç©¶åŠ©æ‰‹

- **æ ¸å¿ƒç»„ä»¶**ï¼šTextLoader + SentenceTransformersTokenTextSplitter + ChromaRetriever + QAPromptor +
  HFGenerator
- **æ¨èå¢å¼º**ï¼šLLMbased_Rerankerï¼ˆå¤æ‚æ¨ç†ï¼‰+ F1Evaluateï¼ˆè´¨é‡è¯„ä¼°ï¼‰
- **ç‰¹ç‚¹**ï¼šæ·±åº¦ç†è§£ã€å¤šæ–‡æ¡£æ¨ç†ã€å­¦æœ¯ä¸¥è°¨

#### ğŸ“° å®æ—¶ä¿¡æ¯é—®ç­”

- **æ ¸å¿ƒç»„ä»¶**ï¼šChromaRetriever + BochaWebSearch + QAPromptor + OpenAIGenerator
- **æ¨èå¢å¼º**ï¼šæ··åˆæ£€ç´¢ç­–ç•¥
- **ç‰¹ç‚¹**ï¼šæ—¶æ•ˆæ€§å¼ºã€ä¿¡æ¯å…¨é¢ã€æ¥æºå¤šæ ·

#### ğŸ¤– æ™ºèƒ½å®¢æœç³»ç»Ÿ

- **æ ¸å¿ƒç»„ä»¶**ï¼šTextLoader + CharacterSplitter + ChromaRetriever + BGEReranker + QAPromptor +
  OpenAIGenerator
- **æ¨èå¢å¼º**ï¼šRecallEvaluateï¼ˆå¬å›ç›‘æ§ï¼‰+ ç¼“å­˜æœºåˆ¶
- **ç‰¹ç‚¹**ï¼šå“åº”å¿«é€Ÿã€å‡†ç¡®ç‡é«˜ã€ç”¨æˆ·ä½“éªŒä½³

## ğŸ›  æŠ€æœ¯è§„æ ¼è¦æ±‚

### ç³»ç»Ÿç¯å¢ƒ

- **Pythonç‰ˆæœ¬**ï¼š3.8+
- **å†…å­˜è¦æ±‚**ï¼šå»ºè®®8GB+ï¼ˆå‘é‡æ¨¡å‹åŠ è½½ï¼‰
- **å­˜å‚¨ç©ºé—´**ï¼šæ ¹æ®çŸ¥è¯†åº“å¤§å°ï¼Œå»ºè®®é¢„ç•™å……è¶³ç©ºé—´
- **GPUæ”¯æŒ**ï¼šå¯é€‰ï¼Œç”¨äºåŠ é€Ÿå‘é‡è®¡ç®—å’Œæ¨¡å‹æ¨ç†

### ä¾èµ–ç»„ä»¶

- **å‘é‡æ•°æ®åº“**ï¼šChromaDBï¼ˆé»˜è®¤ï¼‰
- **åµŒå…¥æ¨¡å‹**ï¼šSentenceTransformers
- **è¯­è¨€æ¨¡å‹**ï¼šOpenAI APIå…¼å®¹æœåŠ¡æˆ–HuggingFaceæ¨¡å‹
- **å¤–éƒ¨API**ï¼šBochaAIï¼ˆå¯é€‰ï¼Œç”¨äºç½‘ç»œæœç´¢ï¼‰

## ğŸ“Š æ€§èƒ½åŸºå‡†

### å…¸å‹æ€§èƒ½æŒ‡æ ‡

| ç»„ä»¶              | å¤„ç†é€Ÿåº¦     | å†…å­˜å ç”¨ | å‡†ç¡®ç‡   |
| ----------------- | ------------ | -------- | -------- |
| CharacterSplitter | ~1000æ–‡æ¡£/ç§’ | ä½       | N/A      |
| ChromaRetriever   | ~100æŸ¥è¯¢/ç§’  | ä¸­ç­‰     | 85-92%   |
| BGEReranker       | ~50æŸ¥è¯¢/ç§’   | ä¸­ç­‰     | 90-95%   |
| OpenAIGenerator   | ~10æŸ¥è¯¢/ç§’   | ä½       | ä¾èµ–æ¨¡å‹ |

### ä¼˜åŒ–å»ºè®®

- **æ‰¹å¤„ç†**ï¼šå¯¹äºå¤§é‡æŸ¥è¯¢ï¼Œä½¿ç”¨æ‰¹å¤„ç†æå‡ååé‡
- **ç¼“å­˜ç­–ç•¥**ï¼šç¼“å­˜å¸¸è§æŸ¥è¯¢ç»“æœï¼Œå‡å°‘é‡å¤è®¡ç®—
- **åˆ†å¸ƒå¼éƒ¨ç½²**ï¼šå¤§è§„æ¨¡åº”ç”¨è€ƒè™‘åˆ†å¸ƒå¼æ¶æ„
- **æ¨¡å‹é‡åŒ–**ï¼šä½¿ç”¨é‡åŒ–æ¨¡å‹å‡å°‘å†…å­˜å ç”¨

## ğŸ” æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### æ£€ç´¢æ— ç»“æœ

- **åŸå› **ï¼šå‘é‡ç´¢å¼•æœªæ­£ç¡®æ„å»ºæˆ–æŸ¥è¯¢å‘é‡åŒ–å¤±è´¥
- **è§£å†³**ï¼šæ£€æŸ¥ç´¢å¼•çŠ¶æ€ï¼ŒéªŒè¯åµŒå…¥æ¨¡å‹ä¸€è‡´æ€§
- **å‚è€ƒ**ï¼š[ç´¢å¼•æ„å»ºæ–‡æ¡£](components/index_build.md)

#### ç”Ÿæˆè´¨é‡å·®

- **åŸå› **ï¼šæ£€ç´¢ä¸Šä¸‹æ–‡ä¸ç›¸å…³æˆ–æç¤ºè¯è®¾è®¡ä¸å½“
- **è§£å†³**ï¼šä¼˜åŒ–æ£€ç´¢ç­–ç•¥ï¼Œæ”¹è¿›æç¤ºè¯æ¨¡æ¿
- **å‚è€ƒ**ï¼š[é‡æ’åºå™¨](components/reranker.md) + [æç¤ºè¯ç”Ÿæˆå™¨](components/promptor.md)

#### å“åº”é€Ÿåº¦æ…¢

- **åŸå› **ï¼šæ¨¡å‹æ¨ç†æ…¢æˆ–æ£€ç´¢æ•°æ®é‡å¤§
- **è§£å†³**ï¼šä½¿ç”¨æ›´å¿«çš„æ¨¡å‹ï¼Œä¼˜åŒ–ç´¢å¼•ç»“æ„
- **å‚è€ƒ**ï¼š[æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ](components/retriever.md)

## ğŸ”— ç›¸å…³èµ„æº

### å­¦ä¹ èµ„æ–™

- [Libs ç”¨æˆ·æŒ‡å—](../README.md)

### ç¤¾åŒºæ”¯æŒ

- **GitHub Issues**ï¼šæŠ€æœ¯é—®é¢˜å’ŒBugæŠ¥å‘Š
- **è®¨è®ºè®ºå›**ï¼šç»éªŒåˆ†äº«å’Œæœ€ä½³å®è·µ
- **ç¤ºä¾‹ä»£ç åº“**ï¼šå®Œæ•´çš„é¡¹ç›®ç¤ºä¾‹

______________________________________________________________________

**è´¡çŒ®æŒ‡å—**ï¼šæ¬¢è¿æäº¤æ–‡æ¡£æ”¹è¿›å»ºè®®å’Œæ–°çš„ä½¿ç”¨ç¤ºä¾‹ã€‚è¯·å‚è€ƒ [å¼€å‘è€…æŒ‡å—](../../../../developers/commands.md) äº†è§£è¯¦ç»†ä¿¡æ¯ã€‚

**è®¸å¯è¯**ï¼šæœ¬æ–‡æ¡£éµå¾ª Apache 2.0 è®¸å¯è¯ã€‚
