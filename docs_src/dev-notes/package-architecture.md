# SAGE åŒ…æ¶æ„

> æœ¬æ–‡æ¡£æè¿° SAGE é¡¹ç›®çš„åŒ…ç»“æ„ã€ä¾èµ–å…³ç³»å’ŒèŒè´£åˆ’åˆ†ã€‚
>
> æœ€åæ›´æ–°ï¼š2025-12-02ï¼ˆä»»åŠ¡ A æ¶æ„æ–‡æ¡£åˆ·æ–°ï¼‰
>
> **å˜æ›´æ—¥å¿—**:
> - 2025-12-02: è¡¥å…… C++ æ‰©å±•ä½ç½®ä¿¡æ¯ï¼Œæ›´æ–° sage-llm-gateway è¯´æ˜ï¼Œç»Ÿä¸€ L6 å±‚æè¿°
> - 2025-10-23: å®Œæ•´æ¶æ„å®¡æŸ¥å®Œæˆ

## ğŸ‰ æ¶æ„å®¡æŸ¥çŠ¶æ€

**å®¡æŸ¥æ—¥æœŸ**: 2025-12-02\
**å®¡æŸ¥èŒƒå›´**: å…¨éƒ¨ 11 ä¸ªåŒ…ï¼ˆå« meta-packageï¼‰ï¼Œ700+ ä¸ª Python æ–‡ä»¶\
**çŠ¶æ€**: âœ… **å®Œæˆ**

### å®¡æŸ¥æˆæœ

| å±‚çº§ | åŒ…å            | æ–‡ä»¶æ•° | æµ‹è¯•é€šè¿‡ | Layer æ ‡è®° | æ¶æ„åˆè§„ | C++ æ‰©å±• | å¤‡æ³¨        |
| ---- | --------------- | ------ | -------- | ---------- | -------- | -------- | ----------- |
| L1   | sage-common     | 22     | âœ… 119   | âœ…         | âœ…       | -        | -           |
| L2   | sage-platform   | 7      | âœ… 30    | âœ…         | âœ…       | -        | -           |
| L3   | sage-kernel     | 268    | âœ… 753   | âœ…         | âœ…       | -        | -           |
| L3   | sage-libs       | 65     | âœ… 169   | âœ…         | âœ…       | -        | 200 skipped |
| L4   | sage-middleware | 150    | âœ… 22    | âœ…         | âœ…       | âœ… sageFlow, NeuromMem | C++ via pybind11 |
| L5   | sage-apps       | 24     | âœ… 21    | âœ…         | âœ…       | -        | -           |
| L5   | sage-benchmark  | 42     | âœ… 17    | âœ…         | âœ…       | -        | -           |
| L6   | sage-studio     | 8      | âœ… 51    | âœ…         | âœ…       | -        | -           |
| L6   | sage-cli        | 45     | âœ… 32    | âœ…         | âœ…       | -        | ç»Ÿä¸€ CLI å…¥å£ |
| L6   | sage-tools      | 106    | âœ… 78    | âœ…         | âœ…       | -        | å¼€å‘å·¥å…·é›†  |
| L6   | sage-llm-gateway    | 8      | âœ… 37    | âœ…         | âœ…       | -        | PyPI: `isage-llm-gateway` |

**æ ¸å¿ƒæŒ‡æ ‡**:

- âœ… æ¶æ„è¿è§„: **0** (å·²å…¨éƒ¨ä¿®å¤)
- âœ… Layer æ ‡è®°è¦†ç›–: **100%** (11/11 åŒ…)
- âœ… æ ¸å¿ƒæµ‹è¯•é€šè¿‡ç‡: **100%** (1,093/1,093 for L1-L4)
- âœ… åº”ç”¨å±‚æµ‹è¯•: **1,300+/1,310+ (99.7%)**
- âœ… ä¾èµ–å…³ç³»: **å•å‘å‘ä¸‹ï¼Œæ¸…æ™°å¯æ§**
- âœ… C++ æ‰©å±•: **2 ä¸ªç»„ä»¶** (sageFlow, NeuromMem in L4)

è¯¦è§: [RPC_QUEUE_REFACTORING_2025.md](https://github.com/intellistream/SAGE/tree/main/docs/dev-notes/cross-layer/architecture)

______________________________________________________________________

## ğŸ“¦ åŒ…æ¦‚è§ˆ

SAGE é‡‡ç”¨åˆ†å±‚å•ä½“æ¶æ„ï¼ˆModular Monolithï¼‰ï¼Œç”± **11 ä¸ªç‹¬ç«‹åŒ… + 1 ä¸ª meta-package** ç»„æˆï¼š

```
L6: sage-studio          # Web UI å¯è§†åŒ–æ¥å£
    sage-cli            # CLI ç»Ÿä¸€å…¥å£ï¼ˆé›†ç¾¤/ä½œä¸š/éƒ¨ç½²ç®¡ç†ï¼‰
    sage-tools          # å¼€å‘å·¥å…·å’Œæµ‹è¯•æ¡†æ¶ï¼ˆsage-dev CLIï¼‰
    sage-llm-gateway        # API Gateway (PyPI: isage-llm-gateway, OpenAI/Anthropic å…¼å®¹)
    â”‚
L5: sage-apps           # ç‰¹å®šé¢†åŸŸåº”ç”¨
    sage-benchmark      # æ€§èƒ½åŸºå‡†æµ‹è¯•
    â”‚
L4: sage-middleware     # é¢†åŸŸç®—å­å’Œç»„ä»¶ âš¡ å« C++ æ‰©å±• (sageFlow, NeuromMem)
    â”‚                   # ä½ç½®: packages/sage-middleware/src/sage/middleware/components/
    â”‚
L3: sage-kernel         # æµå¼æ‰§è¡Œå¼•æ“
    sage-libs           # ç®—æ³•åº“å’Œ Agents æ¡†æ¶
    â”‚
L2: sage-platform       # å¹³å°æœåŠ¡å±‚ï¼ˆé˜Ÿåˆ—ã€å­˜å‚¨ã€æœåŠ¡æŠ½è±¡ï¼‰
    â”‚
L1: sage-common         # åŸºç¡€è®¾æ–½ï¼ˆç±»å‹ã€é…ç½®ã€å·¥å…·ï¼‰

Meta: packages/sage/    # Meta-package (isage)ï¼Œèšåˆå®‰è£…æ‰€æœ‰åŒ…
```

### å±‚çº§è¯´æ˜

- **L1 (Foundation)**: åŸºç¡€è®¾æ–½ï¼Œæ‰€æœ‰åŒ…éƒ½å¯ä»¥ä¾èµ–
- **L2 (Platform)**: å¹³å°æœåŠ¡ï¼ˆé˜Ÿåˆ—ã€å­˜å‚¨ã€æœåŠ¡æŠ½è±¡ï¼‰
- **L3 (Core)**: æ ¸å¿ƒåŠŸèƒ½ï¼Œæä¾›æ‰§è¡Œå¼•æ“å’Œç®—æ³•åº“
- **L4 (Domain)**: é¢†åŸŸç‰¹å®šåŠŸèƒ½ï¼ŒåŸºäº L1-L3 æ„å»ºï¼Œ**å« C++ æ‰©å±•**
- **L5 (Applications)**: åº”ç”¨å±‚ï¼Œç»„åˆä½¿ç”¨ä¸‹å±‚åŠŸèƒ½
- **L6 (Interface)**: ç”¨æˆ·æ¥å£å±‚ï¼ˆWeb UI + CLI + API Gateway + å¼€å‘å·¥å…·ï¼‰

### C++ æ‰©å±•ä½ç½®

SAGE åœ¨ L4 å±‚åŒ…å«ä¸¤ä¸ªä¸»è¦çš„ C++ æ‰©å±•ç»„ä»¶ï¼Œé€šè¿‡ pybind11 æä¾› Python ç»‘å®šï¼š

| ç»„ä»¶ | è·¯å¾„ | æè¿° |
|------|------|------|
| **sageFlow** | `packages/sage-middleware/src/sage/middleware/components/sage_flow/sageFlow/` | é«˜æ€§èƒ½å‘é‡æ£€ç´¢å¼•æ“ï¼Œæ”¯æŒ HNSW/IVF ç­‰ç´¢å¼• |
| **NeuromMem** | `packages/sage-middleware/src/sage/middleware/components/sage_mem/neuromem/` | ç¥ç»è®°å¿†ç³»ç»Ÿï¼Œæ”¯æŒå¤šå±‚è®°å¿†æŠ½è±¡ |

**æ„å»ºäº§ç‰©**: `_sage_flow.cpython-*.so` ç­‰åŠ¨æ€åº“ï¼Œä½äº `.sage/build/` ç›®å½•

**æ„å»ºä¾èµ–**: `cmake`, `build-essential`, `libopenblas-dev`, `liblapack-dev`

### ğŸ“Š è¯¦ç»†å±‚çº§æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              SAGE åˆ†å±‚æ¶æ„ (L1-L6)                                       â”‚
â”‚                          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                â”‚
â”‚                                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ L6: Interface Layer (ç”¨æˆ·æ¥å£å±‚)                                                   â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚ â”‚ sage-studio â”‚ â”‚  sage-cli   â”‚ â”‚ sage-tools  â”‚ â”‚      sage-llm-gateway           â”‚   â”‚  â”‚
â”‚  â”‚ â”‚   Web UI    â”‚ â”‚ ç”Ÿäº§è¿ç»´ CLIâ”‚ â”‚ å¼€å‘å·¥å…·    â”‚ â”‚ OpenAI å…¼å®¹ API Gateway     â”‚   â”‚  â”‚
â”‚  â”‚ â”‚  ç«¯å£: 5173 â”‚ â”‚cluster/job  â”‚ â”‚ sage-dev    â”‚ â”‚ PyPI: isage-llm-gateway         â”‚   â”‚  â”‚
â”‚  â”‚ â”‚      8080   â”‚ â”‚deploy/workerâ”‚ â”‚quality/test â”‚ â”‚ ç«¯å£: 8000 (SagePorts)      â”‚   â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚                                              â”‚
â”‚                                          â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ L5: Application Layer (åº”ç”¨å±‚)                                                     â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚ â”‚          sage-apps              â”‚  â”‚           sage-benchmark                â”‚  â”‚  â”‚
â”‚  â”‚ â”‚ â€¢ article_monitoring (arXiv)    â”‚  â”‚ â€¢ benchmark_rag                         â”‚  â”‚  â”‚
â”‚  â”‚ â”‚ â€¢ auto_scaling_chat             â”‚  â”‚ â€¢ benchmark_memory                      â”‚  â”‚  â”‚
â”‚  â”‚ â”‚ â€¢ smart_home (IoT)              â”‚  â”‚ â€¢ benchmark_agent (Agent èƒ½åŠ›è¯„æµ‹)       â”‚  â”‚  â”‚
â”‚  â”‚ â”‚ â€¢ video (è§†é¢‘æ™ºèƒ½)               â”‚  â”‚ â€¢ benchmark_control_plane (è°ƒåº¦è¯„æµ‹)    â”‚  â”‚  â”‚
â”‚  â”‚ â”‚ â€¢ medical_diagnosis             â”‚  â”‚                                         â”‚  â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚                                              â”‚
â”‚                                          â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ L4: Middleware Layer (ä¸­é—´ä»¶å±‚) âš¡ å« C++ æ‰©å±•                                      â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚ â”‚                           sage-middleware                                   â”‚   â”‚  â”‚
â”‚  â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚  â”‚
â”‚  â”‚ â”‚ â”‚      operators/         â”‚  â”‚              components/                â”‚   â”‚   â”‚  â”‚
â”‚  â”‚ â”‚ â”‚  â€¢ rag/ (æ£€ç´¢/ç”Ÿæˆ)      â”‚  â”‚  â€¢ sage_mem/ (NeuromMem C++)            â”‚   â”‚   â”‚  â”‚
â”‚  â”‚ â”‚ â”‚  â€¢ llm/ (å¯¹è¯/å·¥å…·)      â”‚  â”‚  â€¢ sage_flow/ (sageFlow C++)            â”‚   â”‚   â”‚  â”‚
â”‚  â”‚ â”‚ â”‚  â€¢ tools/ (ç½‘é¡µ/API)    â”‚  â”‚  â€¢ sage_db/ (å‘é‡æ•°æ®åº“)                 â”‚   â”‚   â”‚  â”‚
â”‚  â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â€¢ sage_refiner/ (æ–‡æ¡£ç²¾ç‚¼)             â”‚   â”‚   â”‚  â”‚
â”‚  â”‚ â”‚                              â”‚  â€¢ sage_tsdb/ (æ—¶åºæ•°æ®åº“)               â”‚   â”‚   â”‚  â”‚
â”‚  â”‚ â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚                                              â”‚
â”‚                                          â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ L3: Core Layer (æ ¸å¿ƒå±‚)                                                            â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚ â”‚         sage-kernel             â”‚  â”‚            sage-libs                    â”‚  â”‚  â”‚
â”‚  â”‚ â”‚ â€¢ api/ (Environment, DataStream)â”‚  â”‚ â€¢ agentic/ (Agents, Bots)               â”‚  â”‚  â”‚
â”‚  â”‚ â”‚ â€¢ operators/ (map/filter/join)  â”‚  â”‚ â€¢ rag/ (RAG å·¥å…·)                        â”‚  â”‚  â”‚
â”‚  â”‚ â”‚ â€¢ runtime/ (è°ƒåº¦å™¨, æ‰§è¡Œå¼•æ“)    â”‚  â”‚ â€¢ io/ (FileSource, TerminalSink)        â”‚  â”‚  â”‚
â”‚  â”‚ â”‚ â€¢ distributed/ (åˆ†å¸ƒå¼æ”¯æŒ)     â”‚  â”‚ â€¢ workflow/ (å·¥ä½œæµä¼˜åŒ–)                 â”‚  â”‚  â”‚
â”‚  â”‚ â”‚ â€¢ fault_tolerance/ (å®¹é”™)       â”‚  â”‚ â€¢ integrations/ (OpenAI, Milvus, HF)    â”‚  â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚                                              â”‚
â”‚                                          â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ L2: Platform Layer (å¹³å°å±‚)                                                        â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚ â”‚                           sage-platform                                     â”‚   â”‚  â”‚
â”‚  â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚  â”‚
â”‚  â”‚ â”‚  â”‚     queue/      â”‚  â”‚    storage/     â”‚  â”‚        service/             â”‚  â”‚   â”‚  â”‚
â”‚  â”‚ â”‚  â”‚ Python/Ray/RPC  â”‚  â”‚ Dict/Redis/     â”‚  â”‚      BaseService            â”‚  â”‚   â”‚  â”‚
â”‚  â”‚ â”‚  â”‚ QueueDescriptor â”‚  â”‚ RocksDB Backend â”‚  â”‚ (æœåŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†)           â”‚  â”‚   â”‚  â”‚
â”‚  â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚  â”‚
â”‚  â”‚ â”‚                                                                             â”‚   â”‚  â”‚
â”‚  â”‚ â”‚  âš™ï¸ å·¥å‚æ¨¡å¼: register_rpc_queue_factory() - L2 å®šä¹‰æ¥å£ï¼ŒL3 æ³¨å†Œå®ç°        â”‚   â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚                                              â”‚
â”‚                                          â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ L1: Foundation Layer (åŸºç¡€è®¾æ–½å±‚)                                                  â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚ â”‚                            sage-common                                      â”‚   â”‚  â”‚
â”‚  â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚  â”‚
â”‚  â”‚ â”‚  â”‚    core/      â”‚  â”‚   config/     â”‚  â”‚    utils/     â”‚  â”‚ components/ â”‚   â”‚   â”‚  â”‚
â”‚  â”‚ â”‚  â”‚ Parameter     â”‚  â”‚ SagePorts     â”‚  â”‚ é€šç”¨å·¥å…·      â”‚  â”‚ sage_llm/   â”‚   â”‚   â”‚  â”‚
â”‚  â”‚ â”‚  â”‚ Record        â”‚  â”‚ SageEnvKeys   â”‚  â”‚ æ—¥å¿—ç®¡ç†      â”‚  â”‚ sage_embed/ â”‚   â”‚   â”‚  â”‚
â”‚  â”‚ â”‚  â”‚ Functions     â”‚  â”‚ network.py    â”‚  â”‚ è£…é¥°å™¨        â”‚  â”‚ å‘é‡æ•°æ®åº“  â”‚   â”‚   â”‚  â”‚
â”‚  â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Meta: packages/sage/ (PyPI: isage) - èšåˆå®‰è£…æ‰€æœ‰åŒ…                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¾èµ–è§„åˆ™: L6 â†’ L5 â†’ L4 â†’ L3 â†’ L2 â†’ L1 (å•å‘å‘ä¸‹ï¼Œç¦æ­¢åå‘)
C++ æ‰©å±•: sage-middleware/components/sage_flow/sageFlow/ å’Œ sage_mem/neuromem/
```

#### å…³äº L2 å±‚

âœ… **å·²å®Œæˆ**: é€šè¿‡ 2025-01 æ¶æ„å®¡æŸ¥å’Œé‡æ„ï¼ŒæˆåŠŸåˆ›å»ºäº† **sage-platform (L2) å±‚**ã€‚

**é‡æ„æˆæœ** (commit 1da88c0a - 2025-01-22):

1. **Queue Descriptor** - ä» sage-kernel (L3) è¿ç§»åˆ° sage-platform/queue

   - æä¾› Python/Ray/RPC é˜Ÿåˆ—çš„ç»Ÿä¸€æ¥å£
   - é€šç”¨åŸºç¡€è®¾æ–½ï¼Œæ”¯æŒå¤šç§åˆ†å¸ƒå¼åœºæ™¯

1. **KV Backend** - ä» sage-middleware (L4) è¿ç§»åˆ° sage-platform/storage

   - æä¾› Dict/Redis/RocksDB çš„ç»Ÿä¸€æ¥å£
   - é€šç”¨å­˜å‚¨æŠ½è±¡ï¼Œæ”¯æŒçµæ´»çš„åç«¯æ›¿æ¢

1. **BaseService** - ä» sage-kernel (L3) è¿ç§»åˆ° sage-platform/service

   - è§£å†³äº† sage-common (L1) â†’ sage-kernel (L3) çš„ä¾èµ–è¿è§„
   - æœåŠ¡åŸºç±»ç°åœ¨ä½äºæ­£ç¡®çš„å¹³å°å±‚

**L2 å±‚çš„ä»·å€¼**:

1. âœ… **æ¶æ„æ­£ç¡®æ€§**: åŸºç¡€è®¾æ–½æŠ½è±¡ç‹¬ç«‹äºæ ¸å¿ƒå¼•æ“
1. âœ… **ä¾èµ–æ¸…æ™°**: L1 â†’ L2 â†’ L3 çš„å•å‘ä¾èµ–é“¾
1. âœ… **å¯å¤ç”¨æ€§**: å¹³å°æœåŠ¡è¢«å¤šä¸ªä¸Šå±‚ç»„ä»¶å¤ç”¨
1. âœ… **å¯æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°çš„é˜Ÿåˆ—/å­˜å‚¨åç«¯

**å½“å‰èŒè´£åˆ†å¸ƒ**:

- **sage-common (L1)**: å·¥å…·å‡½æ•°ã€é…ç½®ã€æ—¥å¿—ï¼ˆæ— ä¸šåŠ¡ä¾èµ–ï¼‰
- **sage-platform (L2)**: å¹³å°æœåŠ¡ï¼ˆé˜Ÿåˆ—ã€å­˜å‚¨ã€æœåŠ¡åŸºç±»ï¼‰âœ¨ æ–°å¢
- **sage-kernel (L3)**: æµå¼æ‰§è¡Œå¼•æ“ï¼ˆä¾èµ– L2 çš„é˜Ÿåˆ—æŠ½è±¡ï¼‰
- **sage-middleware (L4)**: é¢†åŸŸç»„ä»¶ï¼ˆä¾èµ– L2 çš„å­˜å‚¨æŠ½è±¡ï¼‰

#### L2/L3 è·¨å±‚ä¾èµ–å¤„ç†ï¼šå·¥å‚æ¨¡å¼

**é—®é¢˜**: RPCQueueDescriptor (L2) éœ€è¦åˆ›å»º RPCQueue (L3) å®ä¾‹ï¼Œä½†ä¸åº”ç›´æ¥å¯¼å…¥ L3 ä»£ç ã€‚

**è§£å†³æ–¹æ¡ˆ**: å·¥å‚æ³¨å†Œæ¨¡å¼ (Factory Registration Pattern)

```python
# L2 (sage-platform) å®šä¹‰æ¥å£å’Œæ³¨å†Œç‚¹
_rpc_queue_factory: Optional[QueueFactory] = None


def register_rpc_queue_factory(factory: QueueFactory) -> None:
    """ç”± L3 å±‚è°ƒç”¨æ³¨å†Œå®ç°"""
    global _rpc_queue_factory
    _rpc_queue_factory = factory


# L3 (sage-kernel) åœ¨åˆå§‹åŒ–æ—¶æ³¨å†Œå®ç°
from sage.platform.queue import register_rpc_queue_factory
from sage.kernel.runtime.communication.rpc import RPCQueue


def _rpc_queue_factory(**kwargs):
    return RPCQueue(**kwargs)


register_rpc_queue_factory(_rpc_queue_factory)
```

**ä¼˜ç‚¹**:

- âœ… L2 ä¸ç›´æ¥å¯¼å…¥ L3 ä»£ç 
- âœ… è¿è¡Œæ—¶åŠ¨æ€ç»‘å®šå®ç°
- âœ… ä¿æŒå±‚çº§ä¾èµ–å•å‘æ€§
- âœ… æ˜“äºæµ‹è¯•å’Œæ›¿æ¢å®ç°

**æ–‡ä»¶ä½ç½®**:

- æ³¨å†Œå‡½æ•°: `packages/sage-platform/src/sage/platform/queue/rpc_queue_descriptor.py`
- æ³¨å†Œè°ƒç”¨: `packages/sage-kernel/src/sage/kernel/__init__.py`
- RPCå®ç°: `packages/sage-kernel/src/sage/kernel/runtime/communication/rpc/rpc_queue.py`

è¯¦è§: [æ¶æ„è®¾è®¡æ–‡æ¡£](https://github.com/intellistream/SAGE/tree/main/docs/dev-notes/cross-layer/architecture)

## ğŸ” åŒ…è¯¦ç»†è¯´æ˜

### sage-common (L1)

**èŒè´£**: åŸºç¡€è®¾æ–½å’Œå…±äº«ç»„ä»¶

**æä¾›**:

- `core`: æ ¸å¿ƒç±»å‹ã€å¼‚å¸¸ã€å‚æ•°ã€æ•°æ®ç»“æ„
- `components`: åŸºç¡€ç»„ä»¶ï¼ˆembeddingã€å‘é‡æ•°æ®åº“ç­‰ï¼‰
- `config`: é…ç½®ç®¡ç†
- `utils`: é€šç”¨å·¥å…·å‡½æ•°
- `model_registry`: æ¨¡å‹æ³¨å†Œè¡¨
- `llm` (ç‹¬ç«‹åŒ… `sage-llm-core`): ç»Ÿä¸€æ¨ç†å®¢æˆ·ç«¯ä¸æ§åˆ¶å¹³é¢ï¼ˆ`sage.llm.*`ï¼‰

**ä¾èµ–**: æ— 

**å…¬å…± API**:

```python
from sage.common import core, components, config, utils, model_registry
from sage.common.core import Parameter, Record, WindowedRecord
from sage.common.components import sage_embedding
from sage.llm import UnifiedInferenceClient  # L1 æ§åˆ¶å¹³é¢/ç»Ÿä¸€å®¢æˆ·ç«¯
```

______________________________________________________________________

### sage-platform (L2)

**èŒè´£**: å¹³å°æœåŠ¡æŠ½è±¡

**æä¾›**:

- `queue`: æ¶ˆæ¯é˜Ÿåˆ—æŠ½è±¡ï¼ˆPython, Ray, RPCï¼‰
- `storage`: KV å­˜å‚¨åç«¯æ¥å£
- `service`: æœåŠ¡åŸºç±»

**ä¾èµ–**: `sage-common`

**å…¬å…± API**:

```python
from sage.platform.queue import BaseQueueDescriptor, RayQueueDescriptor
from sage.platform.storage import BaseKVBackend, DictKVBackend
from sage.platform.service import BaseService
```

______________________________________________________________________

### sage-kernel (L3)

**èŒè´£**: æµå¼æ•°æ®å¤„ç†å¼•æ“å’ŒåŸºç¡€ç®—å­

**æä¾›**:

- `api`: LocalEnvironment, RemoteEnvironment, Function APIs
- `operators`: åŸºç¡€ç®—å­ï¼ˆmap, filter, join, window, aggregateï¼‰
- `runtime`: æ‰§è¡Œå¼•æ“ã€è°ƒåº¦å™¨ã€ä»»åŠ¡ç®¡ç†
- `service`: æœåŠ¡åŸºç±»å’Œå®¢æˆ·ç«¯
- `distributed`: åˆ†å¸ƒå¼è®¡ç®—æ”¯æŒ

**ä¾èµ–**: `sage-common`

**å…¬å…± API**:

```python
from sage.kernel import api
from sage.kernel.api import LocalEnvironment
# Note: Function interfaces (MapFunction, etc.) are now in sage.common.core.functions
from sage.common.core.functions import MapFunction, BatchFunction, SinkFunction
```

______________________________________________________________________

### sage-libs (L3)

**èŒè´£**: ç®—æ³•åº“å’Œ Agents æ¡†æ¶

**æœ€è¿‘æ›´æ–°**: 2025-10-23 - å®Œæˆæ¨¡å—é‡æ„ï¼ˆIssue #1040ï¼‰

**æä¾›**:

- `agents`: LangChain é£æ ¼çš„ Agents æ¡†æ¶ + Pre-built Bots
  - `agents.bots`: é¢„å®šä¹‰çš„æ™ºèƒ½ä½“ï¼ˆAnswerBot, QuestionBot, SearcherBot, CriticBotï¼‰
- `rag`: RAG å·¥å…·å’Œå®ç”¨å‡½æ•°ï¼ˆæ–‡æ¡£åŠ è½½ã€pipelineï¼‰
- `tools`: å·¥å…·å‡½æ•°å’Œè¾…åŠ©ç±»
- `io`: I/O å·¥å…·ï¼ˆsource, sink, batchï¼‰- **é‡å‘½åè‡ª io_utils**
- `workflow`: å·¥ä½œæµä¼˜åŒ–æ¡†æ¶ - **é‡å‘½åè‡ª workflow_optimizer**
- `integrations`: ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ - **æ–°å¢**ï¼ˆOpenAI, Milvus, Chroma, HFï¼‰
- `filters`: æ•°æ®è¿‡æ»¤å™¨ - **æ–°å¢**ï¼ˆtool_filter, evaluate_filterï¼‰
- `context`: ä¸Šä¸‹æ–‡ç®¡ç†
- `unlearning`: éšç§é—å¿˜ç®—æ³•

**é‡æ„æˆæœ** (2025-10-23):

- âœ… è§„èŒƒåŒ–å‘½åï¼ˆio, workflowï¼‰
- âœ… åŠŸèƒ½åˆ†ç±»ï¼ˆintegrations, filtersï¼‰
- âœ… åˆ é™¤åºŸå¼ƒæ¨¡å—ï¼ˆutils, applicationsï¼‰
- âœ… æ·»åŠ  examples.pyï¼ˆagents, rag, unlearningï¼‰
- âœ… å®Œæ•´æ–‡æ¡£è¦†ç›–ï¼ˆ10/10 modulesï¼‰
- âœ… 169 tests passed (0 failed)

è¯¦è§: [sage-libs é‡æ„æ–‡æ¡£](https://github.com/intellistream/SAGE/tree/main/docs/dev-notes/cross-layer/architecture)

**ä¾èµ–**: `sage-common`, `sage-kernel` (å¯é€‰)

**å…¬å…± API**:

```python
# æ ¸å¿ƒæ¨¡å—
from sage.libs import agents, rag, tools, io, workflow, unlearning

# I/O (å·²é‡å‘½å)
from sage.libs.io import FileSource, TerminalSink
from sage.libs.io.batch import JSONLBatch

# Agents & Bots
from sage.libs.agentic.agents import LangChainAgentAdapter
from sage.libs.agentic.agents.bots import AnswerBot, QuestionBot, SearcherBot, CriticBot

# ç¬¬ä¸‰æ–¹é›†æˆ (æ–°å¢)
from sage.libs.integrations import OpenAIClient, MilvusBackend, ChromaBackend

# å·¥ä½œæµä¼˜åŒ– (é‡å‘½å)
from sage.libs.workflow import WorkflowGraph, BaseOptimizer

# æ•°æ®è¿‡æ»¤ (æ–°å¢)
from sage.libs.filters import ToolFilter, EvaluateFilter
```

______________________________________________________________________

### sage-middleware (L4)

**èŒè´£**: é¢†åŸŸç®—å­å’Œä¸­é—´ä»¶ç»„ä»¶

**æä¾›**:

- `operators.rag`: RAG ç®—å­ï¼ˆæ£€ç´¢ã€æç¤ºã€ç”Ÿæˆã€è¯„ä¼°ï¼‰
- `operators.llm`: LLM ç®—å­ï¼ˆå¯¹è¯ã€å·¥å…·è°ƒç”¨ï¼‰
- `operators.tools`: å·¥å…·ç®—å­ï¼ˆç½‘é¡µæŠ“å–ã€API è°ƒç”¨ï¼‰
- `components`: ä¸­é—´ä»¶ç»„ä»¶ï¼ˆsage_mem, sage_db, sage_tsdb, sage_refiner ç­‰ï¼‰

**ä¾èµ–**: `sage-common`, `sage-kernel`, `sage-libs`

**å…¬å…± API**:

```python
from sage.middleware import operators, components
from sage.middleware.operators.rag import ChromaRetriever, QAPromptor, OpenAIGenerator
from sage.middleware.components import sage_mem, sage_db
```

______________________________________________________________________

### sage-apps (L5)

**èŒè´£**: å®é™…åº”ç”¨

**æä¾›**:

- `video`: è§†é¢‘æ™ºèƒ½åˆ†æåº”ç”¨
- `medical_diagnosis`: åŒ»ç–—è¯Šæ–­åº”ç”¨

**ä¾èµ–**: `sage-common`, `sage-kernel`, `sage-libs`, `sage-middleware`

**å…¬å…± API**:

```python
from sage.apps import video, medical_diagnosis
```

______________________________________________________________________

### sage-benchmark (L5)

**èŒè´£**: åŸºå‡†æµ‹è¯•å’Œç¤ºä¾‹

**æä¾›**:

- `benchmark_rag`: RAG åŸºå‡†æµ‹è¯•
- `benchmark_memory`: å†…å­˜æ€§èƒ½æµ‹è¯•

**ä¾èµ–**: `sage-common`, `sage-kernel`, `sage-libs`, `sage-middleware`

**å…¬å…± API**:

```python
from sage.benchmark import benchmark_rag, benchmark_memory
```

______________________________________________________________________

### sage-studio (L6)

**èŒè´£**: Web UI å¯è§†åŒ–æ¥å£

**æä¾›**:

- `StudioManager`: ä¸»ç®¡ç†å™¨
- `models`: æ•°æ®æ¨¡å‹
- `services`: æœåŠ¡å±‚
- `adapters`: Pipeline é€‚é…å™¨
- `frontend`: å‰ç«¯èµ„æº

**ä¾èµ–**: `sage-common`, `sage-kernel`, `sage-libs`, `sage-middleware`

**å…¬å…± API**:

```python
from sage.studio import StudioManager, models, services, adapters
```

______________________________________________________________________

### sage-cli (L6)

**èŒè´£**: ç»Ÿä¸€å‘½ä»¤è¡Œæ¥å£ï¼Œé¢å‘ç”Ÿäº§ç¯å¢ƒçš„é›†ç¾¤/ä½œä¸š/éƒ¨ç½²ç®¡ç†

**æä¾›**:

- `sage` å‘½ä»¤ - SAGE å¹³å°çš„ä¸»è¦ CLI å…¥å£ï¼ˆç”Ÿäº§è¿ç»´ï¼‰
  - `sage cluster` - Ray é›†ç¾¤ç”Ÿå‘½å‘¨æœŸç®¡ç†
  - `sage head` - å¤´èŠ‚ç‚¹å¯åŠ¨ä¸é…ç½®
  - `sage worker` - å·¥ä½œèŠ‚ç‚¹ç®¡ç†
  - `sage job` - ä½œä¸šæäº¤ã€ç›‘æ§ã€å–æ¶ˆ
  - `sage deploy` - åº”ç”¨éƒ¨ç½²åˆ°é›†ç¾¤
  - `sage config` - è¿è¡Œæ—¶é…ç½®ç®¡ç†

**ä¾èµ–**: `sage-common`, `sage-platform`, `sage-kernel`, `sage-libs`, `sage-middleware`

**ä¸ sage-tools çš„åŒºåˆ«**:

| å·¥å…· | å®šä½ | å…¸å‹å‘½ä»¤ |
|------|------|----------|
| `sage` (sage-cli) | ç”Ÿäº§è¿ç»´ | `sage cluster start`, `sage job submit` |
| `sage-dev` (sage-tools) | å¼€å‘è°ƒè¯• | `sage-dev quality`, `sage-dev project test` |

**å…¬å…± API**:

```bash
# CLI ä½¿ç”¨ï¼ˆä¸æ˜¯ Python APIï¼‰
sage --help
sage cluster status
sage job list
```

______________________________________________________________________

### sage-tools (L6)

**èŒè´£**: å¼€å‘å·¥å…·å’Œæµ‹è¯•æ¡†æ¶ï¼Œé¢å‘å¼€å‘è€…çš„è´¨é‡ä¿éšœä¸é¡¹ç›®ç®¡ç†

**æä¾›**:

- `sage-dev`: å¼€å‘è¾…åŠ©å·¥å…·å¥—ä»¶
   - `sage-dev quality` - ä»£ç è´¨é‡æ£€æŸ¥ï¼ˆarchitecture/devnotes/readme/...ï¼‰
   - `sage-dev project` - é¡¹ç›®ç®¡ç†ï¼ˆstatus/analyze/test/clean/...ï¼‰
   - `sage-dev maintain` - ç»´æŠ¤å·¥å…·ï¼ˆdoctorã€hooksã€submodule/...ï¼‰
   - `sage-dev package` - åŒ…å‘å¸ƒ/ç‰ˆæœ¬ç®¡ç†ï¼ˆpypi/version/installï¼‰
   - `sage-dev resource` - æ¨¡å‹ç¼“å­˜ç­‰èµ„æºç®¡ç†
   - `sage-dev github` - GitHub Issues ç®¡ç†
   - `sage-dev examples` - ç¤ºä¾‹åˆ†æä¸æµ‹è¯•
   - `sage-dev docs` - æ–‡æ¡£æ„å»º/é¢„è§ˆ/æ£€æŸ¥
- `sage llm` / `sage embedding` - LLM/Embedding æœåŠ¡ç®¡ç†ï¼ˆå¼€å‘è°ƒè¯•ç”¨ï¼‰
- `sage studio` - Web UI ç®¡ç†ï¼ˆè°ƒç”¨ sage-studioï¼‰
- `sage pipeline` - Pipeline æ„å»ºå·¥å…·
- `finetune`: æ¨¡å‹å¾®è°ƒå·¥å…·
- `management`: ç³»ç»Ÿç®¡ç†å·¥å…·
- `templates`: Pipeline æ¨¡æ¿åº“

**ä¾èµ–**: `sage-common`, `sage-kernel`, `sage-libs`, `sage-middleware`, `sage-studio`

**ä¸ºä»€ä¹ˆåœ¨ L6ï¼Ÿ**

1. **å¼€å‘å·¥å…·å®šä½**: ä¸ºæ‰€æœ‰ä¸‹å±‚åŒ…ï¼ˆL1-L5ï¼‰æä¾›å¼€å‘ã€æµ‹è¯•ã€è´¨é‡æ£€æŸ¥èƒ½åŠ›
2. **æ¨ªå‘å·¥å…·**: ä¸æ˜¯ç”¨æˆ·æ¥å£ï¼Œè€Œæ˜¯å¼€å‘è€…å·¥å…·é›†
3. **ç³»ç»Ÿç®¡ç†**: åŒ…ç®¡ç†ã€æµ‹è¯•æ¡†æ¶ã€ä»£ç è´¨é‡æ£€æŸ¥
4. **ä¾èµ–æ–¹å‘**: éœ€è¦ä¾èµ–æ‰€æœ‰åŒ…ä»¥è¿›è¡Œæµ‹è¯•å’ŒéªŒè¯

**å…¬å…± API**:

```python
from sage.tools import dev, management, templates
```

______________________________________________________________________

### sage-llm-gateway (L6)

**èŒè´£**: ä¸º Studioã€CLI ä»¥åŠå¤–éƒ¨å®¢æˆ·ç«¯æä¾› OpenAI å…¼å®¹çš„ API Gatewayï¼Œå¹¶å°†è¯·æ±‚è½¬æ¢ä¸º SAGE DataStream/RAG æµæ°´çº¿æ‰§è¡Œã€‚

**æä¾›**:

- `FastAPI Server` (`sage.llm.gateway.server`)
   - `/v1/chat/completions`ï¼šOpenAI Chat æ¥å£ï¼Œæ”¯æŒéæµå¼ä¸ SSE æµå¼
   - `/sessions/**`ï¼šèŠå¤©ä¼šè¯ç®¡ç†ï¼ˆåˆ›å»ºã€é‡å‘½åã€æ¸…ç©ºã€åˆ é™¤ã€ç»Ÿè®¡ï¼‰
   - `/memory/**`ï¼šæŸ¥è¯¢/é…ç½®è®°å¿†åç«¯ (`short_term`ã€`vdb`ã€`kv`ã€`graph`)
   - `/admin/index/**`ï¼šRAG ç´¢å¼•çŠ¶æ€ã€æ„å»ºã€åˆ é™¤
- `adapters.openai`ï¼šåè®®é€‚é…å™¨ï¼Œå°†è¯·æ±‚æ³¨å…¥æŒä¹…åŒ–çš„ `RAGPipelineService`ï¼Œå¹¶åœ¨å¿…è¦æ—¶è‡ªåŠ¨æ„å»º `docs-public/docs_src` ç´¢å¼•
- `session.manager`ï¼šä¼šè¯ä¸è®°å¿†ç®¡ç†ï¼Œè½ç›˜åˆ° `~/.sage/gateway/`ï¼Œå¯é€‰ Neuromem collection
- `rag_pipeline`ï¼šåŸºäº `LocalEnvironment + Map/Source/Sink` çš„é•¿é©» Pipelineï¼Œè´Ÿè´£ RAG æ£€ç´¢ä¸å·¥ä½œæµæ„å›¾è¯†åˆ«ï¼ˆè°ƒç”¨ `sage.libs.agentic.workflow`ï¼‰

**ä¾èµ–**: `sage-common`, `sage-kernel`, `sage-libs`, `sage-middleware`

**è¿è¡Œæ–¹å¼**:

```bash
sage-llm-gateway --host 0.0.0.0 --port 8000
python -m sage.llm.gateway.server
sage studio start   # è‹¥æœªæ£€æµ‹åˆ° Gatewayï¼Œä¼šè‡ªåŠ¨æ‹‰èµ·
```

**å…¬å¼€ä½¿ç”¨åœºæ™¯**:

- Studio Chat/Canvasï¼šé»˜è®¤å°† API è¯·æ±‚å‘é€è‡³ Gatewayï¼ˆ`http://{host}:{port}/v1/chat/completions`ï¼‰
- å¤–éƒ¨å®¢æˆ·ç«¯ï¼šé€šè¿‡ OpenAI SDK / cURL ç›´è¿ï¼Œ`api_key` ä»…ç”¨äºé‰´æƒï¼ˆæœ¬åœ°å¯ä»»æ„å­—ç¬¦ä¸²ï¼‰
- è¿è¥ç®¡ç†ï¼šä½¿ç”¨ `/admin/index/build` å¿«é€Ÿ ingest `docs-public`ï¼Œå¹¶é€šè¿‡ `/sessions/cleanup`ã€`SAGE_GATEWAY_LOG_LEVEL` ä¿æŒè¿è¡ŒçŠ¶æ€å¯æ§

## ğŸ”— ä¾èµ–å…³ç³»å›¾

```mermaid
graph TD
    common[sage-common<br/>L1: åŸºç¡€è®¾æ–½]

    platform[sage-platform<br/>L2: å¹³å°æœåŠ¡]

    kernel[sage-kernel<br/>L3: æ‰§è¡Œå¼•æ“]
    libs[sage-libs<br/>L3: ç®—æ³•åº“]

    middleware[sage-middleware<br/>L4: é¢†åŸŸç®—å­<br/>âš¡ C++ æ‰©å±•]

    apps[sage-apps<br/>L5: åº”ç”¨]
    benchmark[sage-benchmark<br/>L5: åŸºå‡†æµ‹è¯•]

    studio[sage-studio<br/>L6: Web UI]
    cli[sage-cli<br/>L6: ç”Ÿäº§ CLI]
    tools[sage-tools<br/>L6: å¼€å‘å·¥å…·]
    gateway[sage-llm-gateway<br/>L6: API Gateway]

    platform --> common

    kernel --> common
    kernel --> platform
    libs --> common
    libs --> kernel

    middleware --> common
    middleware --> platform
    middleware --> kernel
    middleware --> libs

    apps --> common
    apps --> kernel
    apps --> libs
    apps --> middleware

    benchmark --> common
    benchmark --> kernel
    benchmark --> libs
    benchmark --> middleware

    studio --> common
    studio --> kernel
    studio --> libs
    studio --> middleware

    cli --> common
    cli --> platform
    cli --> kernel
    cli --> libs
    cli --> middleware

    tools --> common
    tools --> kernel
    tools --> libs
    tools --> middleware
    tools --> studio

    gateway --> common
    gateway --> kernel
    gateway --> libs
    gateway --> middleware

    style studio fill:#e1f5ff
    style cli fill:#e1f5ff
    style tools fill:#e1f5ff
    style gateway fill:#e1f5ff
    style middleware fill:#fff3cd
```

## ğŸ“‹ ä¾èµ–è§„åˆ™

### âœ… å…è®¸çš„ä¾èµ–

1. **å‘ä¸‹ä¾èµ–**: é«˜å±‚å¯ä»¥ä¾èµ–ä½å±‚

   - L6 â†’ L5, L4, L3, L2, L1
   - L5 â†’ L4, L3, L2, L1
   - L4 â†’ L3, L2, L1
   - L3 â†’ L2, L1
   - L2 â†’ L1

1. **åŒå±‚ç‹¬ç«‹**: åŒå±‚åŒ…ä¹‹é—´ç›¸äº’ç‹¬ç«‹

   - kernel å’Œ libs ç‹¬ç«‹ï¼ˆéƒ½æ˜¯ L3ï¼‰
   - apps, benchmark, tools ç‹¬ç«‹ï¼ˆéƒ½æ˜¯ L5ï¼‰

### âŒ ç¦æ­¢çš„ä¾èµ–

1. **å‘ä¸Šä¾èµ–**: ä½å±‚ä¸èƒ½ä¾èµ–é«˜å±‚

   - common âŒâ†’ ä»»ä½•å…¶ä»–åŒ…
   - platform âŒâ†’ kernel, libs, middleware, apps, tools, studio
   - kernel/libs âŒâ†’ middleware, apps, tools, studio
   - middleware âŒâ†’ apps, benchmark, tools, studio

1. **åå‘ä¾èµ–**: é˜²æ­¢å¾ªç¯ä¾èµ–

   - å¦‚æœ A â†’ Bï¼Œåˆ™ B âŒâ†’ A

1. **è·¨å±‚ä¾èµ–**: é¿å…è·¨å±‚ç›´æ¥ä¾èµ–

   - å°½é‡ä¾èµ–ç›¸é‚»å±‚ï¼Œé¿å…è·¨å¤šå±‚ä¾èµ–

## ğŸ—ï¸ è®¾è®¡åŸåˆ™

### 1. å•å‘ä¾èµ–

ä¾èµ–å…³ç³»å¿…é¡»æ˜¯å•å‘çš„ï¼Œå½¢æˆæœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰ï¼š

- é˜²æ­¢å¾ªç¯ä¾èµ–
- ä¾¿äºç†è§£å’Œæµ‹è¯•
- æ”¯æŒç‹¬ç«‹å‘å¸ƒ

### 2. èŒè´£åˆ†ç¦»

æ¯ä¸ªåŒ…æœ‰æ˜ç¡®çš„èŒè´£è¾¹ç•Œï¼š

- **common**: ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘
- **kernel**: ä¸åŒ…å«é¢†åŸŸç®—å­
- **libs**: ä¸åŒ…å« SAGE ç®—å­å®ç°
- **middleware**: ç»„åˆ kernel + libs æä¾›é¢†åŸŸç®—å­

### 3. æ¥å£ç¨³å®š

ä½å±‚åŒ…æä¾›ç¨³å®šçš„å…¬å…± APIï¼š

- é€šè¿‡ `__init__.py` æ˜ç¡®å¯¼å‡º
- é¿å…ç›´æ¥ä¾èµ–å†…éƒ¨å®ç°
- ç‰ˆæœ¬åŒ–çš„ API å˜æ›´

### 4. æœ€å°ä¾èµ–

æ¯ä¸ªåŒ…åªä¾èµ–å¿…éœ€çš„åŒ…ï¼š

- å‡å°‘è€¦åˆ
- åŠ å¿«æ„å»ºé€Ÿåº¦
- ä¾¿äºç‹¬ç«‹éƒ¨ç½²

## ğŸ“Š åŒ…ç»Ÿè®¡

| åŒ…              | å±‚çº§ | æ¨¡å—æ•°   | æµ‹è¯•æ•°  | ä»£ç è¡Œæ•°  | ä¾èµ–æ•° | C++ æ‰©å±• | æµ‹è¯•çŠ¶æ€    |
| --------------- | ---- | -------- | ------- | --------- | ------ | -------- | ----------- |
| sage-common     | L1   | 15+      | 119     | ~15K      | 0      | -        | âœ… é€šè¿‡     |
| sage-platform   | L2   | 3        | 30      | ~1K       | 1      | -        | âœ… é€šè¿‡     |
| sage-kernel     | L3   | 268      | 753     | ~20K      | 2      | -        | âœ… é€šè¿‡     |
| sage-libs       | L3   | 10       | 169     | ~18K      | 2      | -        | âœ… é€šè¿‡     |
| sage-middleware | L4   | 150      | 22      | ~25K      | 4      | âœ… sageFlow, NeuromMem | âœ… é€šè¿‡     |
| sage-apps       | L5   | 24       | 21      | ~8K       | 4      | -        | âœ… é€šè¿‡     |
| sage-benchmark  | L5   | 42       | 17      | ~12K      | 4      | -        | âœ… é€šè¿‡     |
| sage-studio     | L6   | 8        | 51      | ~8K       | 4      | -        | âœ… é€šè¿‡     |
| sage-cli        | L6   | 45       | 32      | ~5K       | 5      | -        | âœ… é€šè¿‡     |
| sage-tools      | L6   | 106      | 78      | ~10K      | 5      | -        | âœ… é€šè¿‡     |
| sage-llm-gateway    | L6   | 8        | 37      | ~3K       | 4      | -        | âœ… é€šè¿‡     |
| **æ€»è®¡**        | -    | **679+** | **1,329+** | **~125K** | -   | **2** | **99.7%** âœ… |

## ğŸ”„ é‡æ„å†å²

### ğŸš§ å¾…åŠ: 2025-10 Kernel API å±‚é‡æ„ (Issue #1041)

**é—®é¢˜**:

1. sage-libs (L3) ä¾èµ– sage-kernel (L3) - åŒå±‚ä¾èµ–ä¸æ¸…æ™°
1. kernel.api åœ¨ L3ï¼Œä½† BaseService åœ¨ L2 - å±‚çº§ä¸ä¸€è‡´
1. kafka_source.py é‡å¤å®ç°ï¼ˆkernel å’Œ libs éƒ½æœ‰ï¼‰

**ä¾èµ–ç»Ÿè®¡**:

- sage-libs â†’ sage.kernel: 14æ¬¡å¯¼å…¥ (MapFunction, FilterFunction, SinkFunctionç­‰)
- sage-middleware â†’ sage.kernel: 15æ¬¡å¯¼å…¥ (MapOperator)

**è§£å†³æ–¹æ¡ˆ**: å°†å‡½æ•°æ¥å£ä¸‹æ²‰åˆ° sage-common (L1)

**æ ¸å¿ƒå†³ç­–** (2025-10-24):

1. âœ… **å‡½æ•°æ¥å£ â†’ L1 (common/core/functions)**

   - 13ä¸ªåŸºç¡€å‡½æ•°æ¥å£è¿ç§»åˆ° common
   - PrintSink è¿ç§»åˆ° common/components/debug
   - ç†ç”±: libs éœ€è¦ç»§æ‰¿è¿™äº›æ¥å£ï¼Œåº”è¯¥ç‹¬ç«‹äº kernel

1. âœ… **åˆ é™¤ kafka_source.py**

   - åˆ é™¤ kernel ä¸­çš„é‡å¤å®ç°
   - æ”¹è¿› libs ä¸­çš„å®ç°ä¸ºå®Œæ•´ç‰ˆæœ¬

1. âœ… **ä¸€æ¬¡æ€§è¿ç§»** + ä¿ç•™å…¼å®¹å±‚

**æ–°æ¶æ„åˆ†å±‚**:

```
L1 (sage-common)
â””â”€â”€ core/functions/     # âœ… æ–°å¢: BaseFunction, MapFunctionç­‰ (13ä¸ª)

L2 (sage-platform)
â””â”€â”€ queue/storage/service  # å¹³å°æœåŠ¡

L3 (sage-kernel)
â””â”€â”€ api/                # Environment + DataStream (æ‰§è¡Œç¯å¢ƒ)
    â”œâ”€â”€ operator/       # å†…éƒ¨ç®—å­å®ç°
    â””â”€â”€ transformation/ # è½¬æ¢é€»è¾‘

L3 (sage-libs)
â””â”€â”€ ä½¿ç”¨ common.functions (ä¸å†ä¾èµ– kernel)
```

**é¢„æœŸæˆæœ**:

- âœ… sage-libs (L3) â†’ sage-common (L1) - æ¸…æ™°çš„å‘ä¸‹ä¾èµ–
- âœ… è§£å†³ L3 â†” L3 åŒå±‚ä¾èµ–é—®é¢˜
- âœ… å‡½æ•°æ¥å£åœ¨æœ€åº•å±‚ï¼Œæœ€å¤§åŒ–å¤ç”¨
- âœ… libs å®Œå…¨ç‹¬ç«‹äº kernel

**é¢„è®¡å·¥ä½œé‡**: 7-8å°æ—¶ï¼Œå½±å“~32-47ä¸ªæ–‡ä»¶

è¯¦è§: [kernel é‡æ„åˆ†æ](https://github.com/intellistream/SAGE/tree/main/docs/dev-notes/l3-kernel)

______________________________________________________________________

### 2025-10 sage-libs æ¨¡å—é‡æ„ (Issue #1040)

**é—®é¢˜**:

1. æ¨¡å—å‘½åä¸è§„èŒƒï¼ˆio_utils, workflow_optimizerï¼‰
1. åŠŸèƒ½åˆ†ç±»ä¸æ¸…æ™°ï¼ˆutils æ··æ‚å¤šç§åŠŸèƒ½ï¼‰
1. ç¬¬ä¸‰æ–¹é›†æˆå’Œè¿‡æ»¤å™¨åˆ†æ•£åœ¨ä¸åŒæ¨¡å—
1. ç¼ºå°‘æ ‡å‡†æ–‡æ¡£å’Œç¤ºä¾‹

**è§£å†³æ–¹æ¡ˆ** (4 ä¸ªé˜¶æ®µ):

1. âœ… **Phase 1 - ç›®å½•é‡ç»„**:

   - é‡å‘½å: `io_utils` â†’ `io`, `workflow_optimizer` â†’ `workflow`
   - æ–°å»º: `integrations/` (5ä¸ªç¬¬ä¸‰æ–¹é›†æˆ), `filters/` (4ä¸ªè¿‡æ»¤å™¨)
   - é‡ç»„: `agents/bots/` (4ä¸ªé¢„å®šä¹‰æ™ºèƒ½ä½“)
   - åˆ é™¤: `utils/`, `applications/` (åºŸå¼ƒæ¨¡å—)

1. âœ… **Phase 2 - æ¨¡å—æ ‡å‡†åŒ–**:

   - æ·»åŠ  6 ä¸ª `__init__.py` (è§„èŒƒå¯¼å‡º)
   - æ·»åŠ  4 ä¸ª `README.md` (æ–‡æ¡£)
   - æ·»åŠ  3 ä¸ª `examples.py` (agents, rag, unlearning)

1. âœ… **Phase 3 - å¯¼å…¥è·¯å¾„æ›´æ–°**:

   - æ›´æ–° 29 ä¸ªæ–‡ä»¶çš„å¯¼å…¥è·¯å¾„
   - è¦†ç›– 7 ä¸ªåŒ…ï¼ˆlibs, middleware, apps, benchmark, studio, tools, examplesï¼‰

1. âœ… **Phase 4 - æ¸…ç†ä¸éªŒè¯**:

   - åˆ é™¤ `applications/` ç©ºç›®å½•
   - ä¿®å¤ `tools/image_captioner.py` å¯¼å…¥
   - å®Œæˆæ‰€æœ‰ç¤ºä¾‹ä»£ç 

**æˆæœ**:

- âœ… 10 ä¸ªè§„èŒƒæ¨¡å—ï¼ˆvs 12 ä¸ªæ··ä¹±æ¨¡å—ï¼‰
- âœ… 169/169 æµ‹è¯•é€šè¿‡ (0 å¤±è´¥)
- âœ… æ¸…æ™°çš„åŠŸèƒ½åˆ†ç±»
- âœ… å®Œæ•´çš„æ–‡æ¡£è¦†ç›– (10/10 modules)
- âœ… è§„èŒƒçš„ API å¯¼å‡º

å‚è§: [sage-libs é‡æ„æ–‡æ¡£](https://github.com/intellistream/SAGE/tree/main/docs/dev-notes/l3-libs)

### 2025-01 é‡å¤§é‡æ„

**é—®é¢˜**:

1. libs â†’ middleware åå‘ä¾èµ–ï¼ˆlongrefinerï¼‰
1. åŒ…å¯¼å‡ºä¸å®Œæ•´
1. æµ‹è¯•æ–‡ä»¶æ··åˆåœ¨æºä»£ç ä¸­

**è§£å†³æ–¹æ¡ˆ**:

1. âœ… åˆ é™¤ libs/rag/longrefiner é€‚é…å™¨
1. âœ… æ›´æ–°æ‰€æœ‰ `__init__.py`ï¼Œæ­£ç¡®å¯¼å‡ºå…¬å…± API
1. âœ… å°†æ‰€æœ‰æµ‹è¯•æ–‡ä»¶ç§»åŠ¨åˆ° `tests/` ç›®å½•
1. âœ… æ›´æ–°å¯¼å…¥è·¯å¾„ï¼ˆ30+ æ–‡ä»¶ï¼‰
1. âœ… åˆ›å»ºæ¶æ„æ–‡æ¡£

**ç»“æœ**:

- æ— å¾ªç¯ä¾èµ–
- æ¸…æ™°çš„åŒ…è¾¹ç•Œ
- æ ‡å‡†åŒ–çš„æµ‹è¯•ç»“æ„
- å®Œæ•´çš„æ–‡æ¡£

å‚è§: [æ¶æ„å®¡æŸ¥æ–‡æ¡£](https://github.com/intellistream/SAGE/tree/main/docs/dev-notes/cross-layer/architecture)

### 2025-01 æ¶æ„å®¡æŸ¥ï¼ˆTop-Layer Reviewï¼‰

**å®¡æŸ¥èŒƒå›´**: sage-studio (L6), sage-apps/benchmark/tools (L5)

**å·²è§£å†³çš„é—®é¢˜**:

1. **L2 å±‚ç¼ºå¤±** âœ… (å·²è§£å†³)

   - **Queue Descriptor** - å·²è¿ç§»åˆ° `sage-platform/queue`
   - **KV Backend** - å·²è¿ç§»åˆ° `sage-platform/storage`
   - **BaseService** - å·²è¿ç§»åˆ° `sage-platform/service`

1. **è·¨å±‚ä¾èµ–é—®é¢˜** âœ… (å·²è§£å†³)

   - **sage-common â†’ sage-kernel** (L1 â†’ L3 è¿è§„) - å·²é€šè¿‡ L2 å±‚è§£å†³
   - BaseService ç°åœ¨ä½äº sage-platform (L2)ï¼Œä¾èµ–é“¾æ­£ç¡®: L1 â†’ L2 â†’ L3

1. **ä»£ç ä½ç½®é—®é¢˜** âœ… (å·²ä¿®å¤)

   - **sage-tools**: TestFailureCache å·²ç§»åŠ¨åˆ° src/
   - **sage-tools å±‚çº§**: å·²æå‡åˆ° L6ï¼ˆæ¥å£å±‚ï¼‰

1. **åŒ…ä¾èµ–ä¼˜åŒ–** âœ… (å·²ä¿®å¤)

   - **sage-tools**: ç§»é™¤äº†å¯¹ sage-apps å’Œ sage-benchmark çš„ä¸å¿…è¦ä¾èµ–
   - sage-tools ç°åœ¨åªä¾èµ–çœŸæ­£éœ€è¦çš„åŒ…ï¼šcommon, kernel, libs, middleware, studio

**å·²æ”¹è¿›**:

1. **æµ‹è¯•è¦†ç›–æå‡** âœ… (å·²å®Œæˆ)

   - **sage-benchmark**: ä» 1 ä¸ªæµ‹è¯• â†’ 17 ä¸ªæµ‹è¯• (+1600%)
     - test_config_loading.py: é…ç½®æ–‡ä»¶éªŒè¯ï¼ˆ5 testsï¼‰
     - test_pipelines.py: Pipeline ç»“æ„å’Œå¯¼å…¥æµ‹è¯•ï¼ˆ12 testsï¼‰
   - **sage-apps**: ä» 2 ä¸ªæµ‹è¯• â†’ 21 ä¸ªæµ‹è¯• (+950%)
     - test_medical_diagnosis.py: åŒ»ç–—è¯Šæ–­åº”ç”¨ç»“æ„æµ‹è¯•ï¼ˆ10 testsï¼‰
     - test_video_app.py: è§†é¢‘åº”ç”¨ç»“æ„å’Œç®—å­æµ‹è¯•ï¼ˆ11 testsï¼‰
   - **æ€»æå‡**: L5-L6 åŒ…ä» 68 ä¸ªæµ‹è¯• â†’ 103 ä¸ªæµ‹è¯• (+51.5%)

1. **å±‚çº§ä»£ç å®¡æŸ¥** âœ… (å·²å®Œæˆ)

   - æ‰€æœ‰é¡¶å±‚åŒ…ï¼ˆsage-studio, sage-tools, sage-apps, sage-benchmarkï¼‰å·²å®¡æŸ¥
   - æ— ä»£ç éœ€è¦åœ¨å±‚ä¹‹é—´è¿ç§»
   - æ‰€æœ‰åŒ…ä¾èµ–å…³ç³»ç¬¦åˆå±‚çº§æ¶æ„ï¼ˆæ— å‘ä¸Šä¾èµ–ï¼‰
   - è¯¦ç»†æŠ¥å‘Š: `docs/dev-notes/TEST_COVERAGE_REPORT_TOP_LAYERS.md`

**æœªæ¥æ”¹è¿›æ–¹å‘**:

1. **åŠŸèƒ½æµ‹è¯•æ‰©å±•** (è®¡åˆ’ä¸­)
   - sage-benchmark: ä¸º 16 ä¸ª Pipeline å®ç°æ·»åŠ åŠŸèƒ½æµ‹è¯•
   - sage-apps: æ·»åŠ  Agent å’Œ Operator åŠŸèƒ½æµ‹è¯•
   - æ·»åŠ ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•

**å»ºè®®çš„é‡æ„æ–¹æ¡ˆ**:

```
åˆ›å»ºæ–°çš„ sage-platform (L2) åŒ…ï¼š

packages/
  sage-platform/          # L2 - å¹³å°æœåŠ¡å±‚ï¼ˆæ–°å»ºï¼‰
    src/sage/platform/
      queue/              # ä» sage-kernel/runtime/communication/queue_descriptor ç§»åŠ¨
        base_queue_descriptor.py
        python_queue_descriptor.py
        ray_queue_descriptor.py
        rpc_queue_descriptor.py

      storage/            # ä» sage-middleware/components/sage_mem ç§»åŠ¨
        kv_backend/
          base_kv_backend.py
          dict_kv_backend.py
          # æœªæ¥æ‰©å±•: redis_kv_backend.py, rocksdb_kv_backend.py

      service/            # ä» sage-kernel ç§»åŠ¨
        base_service.py   # è§£å†³ sage-common çš„ä¾èµ–é—®é¢˜
```

**æ›´æ–°åçš„æ¶æ„å±‚çº§**:

```
L1 (sage-common)       - é€šç”¨å·¥å…· (logging, config, decorators)
L2 (sage-platform)     - å¹³å°æœåŠ¡ (queue, storage, service åŸºç±») [å¾…åˆ›å»º]
L3 (sage-kernel, libs) - æ ¸å¿ƒå¼•æ“ (runtime, jobmanager, compiler, algorithms)
L4 (sage-middleware)   - é¢†åŸŸç»„ä»¶ (neuromem, sageDB, sageFlow, RAG operators)
L5 (sage-apps, tools)  - åº”ç”¨å±‚
L6 (sage-studio)       - æ¥å£å±‚
```

**çŠ¶æ€**:

- âœ… å®¡æŸ¥å®Œæˆ
- âœ… é‡æ„å®Œæˆ (commit 1da88c0a - 2025-01-22)

**é‡æ„æˆæœ**:

- åˆ›å»º sage-platform (L2) åŒ…
- è¿ç§» Queue Descriptor, KV Backend, BaseService åˆ° L2
- æ›´æ–° 60+ ä¸ªæ–‡ä»¶çš„å¯¼å…¥è·¯å¾„
- ä¿®å¤ L1â†’L3 ä¾èµ–è¿è§„
- æ‰€æœ‰æµ‹è¯•é€šè¿‡

å‚è§: [æ¶æ„å®¡æŸ¥æ–‡æ¡£](https://github.com/intellistream/SAGE/tree/main/docs/dev-notes/cross-layer/architecture)

## ğŸš€ ä½¿ç”¨æŒ‡å—

### å¯¼å…¥æœ€ä½³å®è·µ

**âœ… æ¨è**:

```python
# ä»åŒ…çš„å…¬å…± API å¯¼å…¥
from sage.kernel.api import LocalEnvironment
from sage.middleware.operators.rag import ChromaRetriever
from sage.libs.agentic.agents import LangChainAgentAdapter
```

**âŒ ä¸æ¨è**:

```python
# ä¸è¦ç›´æ¥å¯¼å…¥å†…éƒ¨æ¨¡å—
from sage.kernel.runtime.dispatcher import Dispatcher
from sage.middleware.operators.rag.retriever.chroma_retriever import ChromaRetrieverImpl
```

### æ·»åŠ æ–°åŠŸèƒ½

1. **ç¡®å®šåˆé€‚çš„å±‚çº§**:

   - åŸºç¡€ç±»å‹/å·¥å…· â†’ common
   - åŸºç¡€ç®—å­ â†’ kernel
   - ç®—æ³•/å·¥å…· â†’ libs
   - é¢†åŸŸç®—å­ â†’ middleware
   - åº”ç”¨ â†’ apps/benchmark/tools

1. **éµå¾ªä¾èµ–è§„åˆ™**:

   - åªä¾èµ–æ›´ä½å±‚çš„åŒ…
   - é€šè¿‡å…¬å…± API å¯¼å…¥

1. **æ›´æ–°å¯¼å‡º**:

   - åœ¨ `__init__.py` ä¸­å¯¼å‡ºå…¬å…± API
   - ç¼–å†™ docstring è¯´æ˜

1. **æ·»åŠ æµ‹è¯•**:

   - åœ¨åŒ…çš„ `tests/` ç›®å½•ä¸­æ·»åŠ 

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [æ¶æ„è®¾è®¡æ–‡æ¡£](https://github.com/intellistream/SAGE/tree/main/docs/dev-notes/cross-layer/architecture) - è¯¦ç»†æ¶æ„åˆ†æ
- [è´¡çŒ®æŒ‡å—](https://github.com/intellistream/SAGE/blob/main/CONTRIBUTING.md) - å¦‚ä½•å‚ä¸å¼€å‘

## ğŸ› ï¸ æ¶æ„ç›¸å…³å‘½ä»¤

SAGE æä¾›äº†ä¾¿æ·çš„å‘½ä»¤æ¥æŸ¥çœ‹å’Œæ£€æŸ¥æ¶æ„ï¼š

### æŸ¥çœ‹æ¶æ„ä¿¡æ¯

```bash
# æŸ¥çœ‹å®Œæ•´æ¶æ„å®šä¹‰ï¼ˆå±‚çº§å’Œä¾èµ–å…³ç³»ï¼‰
sage-dev architecture

# æŸ¥çœ‹ç‰¹å®šåŒ…çš„ä¿¡æ¯
sage-dev architecture --package sage-kernel

# JSON æ ¼å¼è¾“å‡ºï¼ˆç”¨äºå·¥å…·é›†æˆï¼‰
sage-dev architecture --format json

# Markdown æ ¼å¼è¾“å‡ºï¼ˆç”¨äºæ–‡æ¡£ç”Ÿæˆï¼‰
sage-dev architecture --format markdown
```

### æ£€æŸ¥æ¶æ„åˆè§„æ€§

```bash
# æ£€æŸ¥æ‰€æœ‰æ–‡ä»¶
sage-dev quality architecture

# ä»…æ£€æŸ¥å˜æ›´çš„æ–‡ä»¶
sage-dev quality architecture --changed-only

# å¯¹æ¯”ç‰¹å®šåˆ†æ”¯
sage-dev quality architecture --diff main
```

### ç»¼åˆè´¨é‡æ£€æŸ¥

```bash
# è¿è¡Œæ‰€æœ‰è´¨é‡æ£€æŸ¥ï¼ˆåŒ…æ‹¬æ¶æ„ã€dev-notesã€README ç­‰ï¼‰
sage-dev quality check

# ä»…æ£€æŸ¥å˜æ›´æ–‡ä»¶
sage-dev quality check --all-files
```

æ›´å¤šå‘½ä»¤è¯·å‚è€ƒ [sage-tools æ–‡æ¡£](https://github.com/intellistream/SAGE/tree/main/packages/sage-tools)ã€‚

## ğŸ¤ è´¡çŒ®

å¦‚æœæ‚¨å‘ç°æ¶æ„é—®é¢˜æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œè¯·ï¼š

1. æŸ¥çœ‹ç°æœ‰ issues
1. åˆ›å»ºæ–° issue è®¨è®º
1. æäº¤ PR å¹¶é™„ä¸Šè¯´æ˜

è¯¦æƒ…å‚è§ [è´¡çŒ®æŒ‡å—](https://github.com/intellistream/SAGE/blob/main/CONTRIBUTING.md)ã€‚éµå¾ªæ¶æ„åŸåˆ™æœ‰åŠ©äºä¿æŒä»£ç åº“çš„å¥åº·å’Œå¯ç»´æŠ¤æ€§ï¼
